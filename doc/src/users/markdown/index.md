<!--
SPDX-FileCopyrightText: 2002-2023 Rice University
SPDX-FileCopyrightText: 2024 Contributors to the HPCToolkit Project

SPDX-License-Identifier: CC-BY-4.0
-->

# Overview

HPCToolkit provides the `hpcviewer` ([Adhianto, Mellor-Crummey, and Tallent 2010](https://doi.org/10.1109/ICPPW.2010.35); [N. R. Tallent et al. 2011](http://doi.acm.org/10.1145/1995896.1995908)) performance presentation tool for interactive examination of performance databases.
`hpcviewer` presents a heterogeneous
calling context tree that spans both CPU and GPU contexts, annotated
with measured or derived metrics to help users assess code performance
and identify bottlenecks.

The database generated by `hpcprof` consists of 4 dimensions: 
- *Execution context* (also called *execution profile*) which include any logical threads (such as OpenMP, pthread and C++ threads), and also MPI processes and GPU streams.
- *Time* which represents the timeline of the program's execution. This time dimension is only available if the application is profiled with traces enabled (`hpcrun` `-t` option).
- *Call-path* which depicts a top-down path in a calling-context tree.
- *Metric* which constitutes program measurements performed by `hpcrun` such as cycles, number of instructions, stall percentages and also some derived metrics such as ratio of idleness.

To simplify performance data visualization, `hpcviewer` restricts
display two dimensions at a time: the [*Profile View*](profile.html#sec:profile) displays
pairs of (call-path, metric) or (execution context,
metric) dimensions; and the [*Trace View*](trace.html#sec:trace) visualizes the
behavior of execution contexts over time.
Table below summarizes views supported by hpcviewer.

| View                  | Dimension                    | Note                                                                |
| :-------------------- | :--------------------------- | :------------------------------------------------------------------ |
| Profile - [Metric view](profile.html#sec:pane-metric)            | Call-path x Metrics  | display the tree and its associated metrics                         |
| Profile - [Thread view](profile.html#sec:hpcviewer:thread-level) | Call-path x Metrics  | display the tree and its metrics for a set of execution contexts    |
| Profile - [Graph view](profile.html#sec:hpcviewer:plots)         | Execution contexts x Metric | display a metric of a specific tree node for all execution contexts |
| Trace - [Main view](trace.html#sec:mainview)                     | Execution contexts x Time   | display execution context behavior over time                        |
| Trace - [Depth view](trace.html#sec:depthview)    | Call-path x Time     | display call stacks over time of an execution context               |

Note that in the Profile view, GPU stream execution contexts are not shown in this view; metrics for a GPU operation are associated with the calling context in the thread that initiated the GPU operation (Section [Thread View](profile.html#sec:hpcviewer:thread-level)).
In the Trace view, GPU streams have their own trace lines independently from their host so that it allows to separate traces between hosts and devices.

## Launching

Requirements to launch `hpcviewer`:

- On all platforms: Java 17 or newer (up to Java 21).
- On Linux: GTK 3.20 or newer.

`hpcviewer` can either be launched from a command line (Linux platforms) or by clicking the `hpcviewer` icon (for Windows, Mac OS X and Linux platforms).
The command line syntax is as follows:

```
 hpcviewer [options] [<hpctoolkit-database>]
```

Here, `<hpctoolkit-database>` is an optional argument to load a database automatically.
Without this argument, `hpcviewer` will prompt for the location of a database. Possible options for `hpcviewer` are shown below:

`-h, --help`
: Print a help message.

`-jh, --java-heap` *size*
: Set the JVM maximum heap size for this execution of `hpcviewer`. The value of *size* must be in megabytes (M) or gigabytes (G). For example, one can specify a *size* of 3 gigabytes as either 3076M or 3G.

`-v, --version`
: Print the current version

On Linux, when `hpcviewer` is installed using its `install.sh` script, which chooses a default maximum size for the Java heap on the current platform. When analyzing measurements for large and complex applications, it may be necessary to use the `--java-heap` option to specify a larger heap size for `hpcviewer` to accommodate many metrics for many contexts.

On MacOs and Windows the value of JVM maximum heap size is stored in `hpcviewer.ini` file, specified with `-Xmx` option.
On MacOS, this file is located at `hpcviewer.app/Contents/Eclipse/hpcviewer.ini`.


## Menus

`hpcviewer` provides four main menus:

### File

This menu includes several menu items for controlling basic viewer operations.

- **New window**\
  Open a new `hpcviewer` window that is independent from the existing one.
  However, filtering CCT node operation (Section [Filtering Tree Nodes](profile.html#sec:filter)) will also affect all `hpcviewer` windows.
- **Open database**\
  Open a database without replacing the existing one. This menu can be used to compare two databases.
  Currently `hpcviewer` restricts maximum of two database open at a time.
- **Open remote database** *(experimental feature)* \
  Open a database located at the remote host via a secured SSH tunnel. Once can use the private key to connect without typing password.
- **Switch database** \
  Load a performance database into the current `hpcviewer` window replacing the existing opened databases.
- **Close database** \
  Unloading an open database.
- **Merge databases** \
  Merging two database that are currently in the viewer.
  At the moment `hpcviewer` doesn't support storing a merged database into a file.
    - **Top-down tree**: Merging the top-down tree of the databases.
    - **Flat tree**: Merging the flat (static) tree of the databases.
- **Preferences** \
  Display the settings dialog box which consists of three sections:
    - **Appearance**: Change the fonts for tree and metric columns and source viewer.
    - **Traces**: Specify settings for Trace view such as the rendering option, the number of working threads to be used and the tooltip's delay.
    - **Debug**: Enable/disable debug mode and experimental feature.
- **Exit** \
  Quit the `hpcviewer` application.

### Filter

This menu only contains one submenu:

- **Filter CCT nodes** \
  Open a filter property window which lists a set of filters and its properties (Section [Filtering Tree Nodes](profile.html#sec:filter)).
- **Filter execution contexts** (Trace view only) \
  Open a window for selecting which nodes will be hidden in the tree.

### View

This window shows that any procedure names that match with "MPI*" pattern are assigned with red, while procedures that match with "PMPI*" pattern are assigned with color black.

This menu is only visible if at least one database is loaded.
All actions in this menu are intended primarily for tool developer use.
By default, the menu is hidden. Once you open a database, the menu is then shown.

- **Show metrics** *(Profile view only)* \
  Display a list of (metric name, metric name description) pairs in a window. For GPU metrics, the descriptions are useful for explaining what the short and somewhat cryptic metric names mean.
  From this window, you can use the edit button to modify the name of the selected metric. When editing a derived metric, the metric editor will allow you to modify the formula for the metric in addition to the name.
  Once you modify a metric and exit this window by selecting the OK button, the metric pane will refresh the display of any metrics whose name or formula was modified.
- **Show color mapping** *(Trace view only)* \
  Open a window which shows customized mapping between a procedure pattern and a color. See [trace.html#sec:color-map](Customize color Map) Section.
- **Debug** *(if the debug mode is enabled)* \
    - **Show database raw's XML**:
    Enable one to request display of HPCToolkit's raw XML representation for performance data (only for old HPCToolkit database).


### Help

This menu displays information about the viewer. The menu contains only one menu item:

- **About** \
  Displays brief information about the viewer, including JVM and Eclipse variables, and error log files.

## Limitations

Some important `hpcviewer` limitations are listed below:

- **Limited number of metric columns**. \
  With a large number of metric columns, `hpcviewer`'s response time may become sluggish as this requires a large amount of memory.
- **Experimental Windows 11 platform**. \
  The Windows version of `hpcviewer` is mainly tested on Windows 10. Support for Windows 11 is still experimental.
- **Dark theme on Linux platforms**. \
  We received reports that `hpcviewer` is not very visible on Linux with dark theme. Support for dark theme on Linux is still an ongoing work.
- **Linux TWM window manager is not supported**. \
  Reason: this window manager is too ancient.
  